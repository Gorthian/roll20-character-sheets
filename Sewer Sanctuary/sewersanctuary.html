<!---------->
<!--HEARTS-->
<!---------->
<div class="sheet-heartbox-group">
    <label class="sheet-checkbox-heart">
        <input type="checkbox" name="attr_heartbox1" value="1">
        <span></span>
    </label>
    <label class="sheet-checkbox-heart">
        <input type="checkbox" name="attr_heartbox2" value="1">
        <span></span>
    </label>
    <label class="sheet-checkbox-heart">
        <input type="checkbox" name="attr_heartbox3" value="1">
        <span></span>
    </label>
    <label class="sheet-checkbox-heart">
        <input type="checkbox" name="attr_heartbox4" value="1">
        <span></span>
    </label>
    <label class="sheet-checkbox-heart">
        <input type="checkbox" name="attr_heartbox5" value="1">
        <span></span>
    </label>
	<label class="sheet-checkbox-heart">
        <input type="checkbox" name="attr_heartbox6" value="1">
        <span></span>
    </label>
    <label class="sheet-checkbox-heart">
        <input type="checkbox" name="attr_heartbox7" value="1">
        <span></span>
    </label>
    <label class="sheet-checkbox-heart">
        <input type="checkbox" name="attr_heartbox8" value="1">
        <span></span>
    </label>
    <label class="sheet-checkbox-heart">
        <input type="checkbox" name="attr_heartbox9" value="1">
        <span></span>
    </label>
    <label class="sheet-checkbox-heart">
        <input type="checkbox" name="attr_heartbox10" value="1">
        <span></span>
    </label>
	
	<input type="hidden" name="attr_hp">
	<input type="hidden" name="attr_hp_max">
</div>

<!---------------->
<!-- NAME & AGE -->
<!---------------->
<div class="sheet-name_age-container">
	<input type="text" id="sheet-adventurerName" name="attr_charactername" placeholder="Harry Boo" spellcheck="false">
	
	<input type="text" id="sheet-adventurerAge" name="attr_characterage" pattern="\d{1,3}" placeholder="0" spellcheck="false">
	<input type="hidden" name="attr_characterage_max" value="2500">
</div>

<!---------------------------------->
<!-- OCCUPATION, GOLD & CONDITION -->
<!---------------------------------->
<div class="sheet-occupation_gold_condition-container">
	<input type="text" id="sheet-adventurerOccupation" name="attr_characteroccupation" placeholder="Adventurer" spellcheck="false">
	
	<input type="text" id="sheet-adventurerGold" name="attr_charactergold" pattern="\d{1,3}" placeholder="0" spellcheck="false">
	<input type="hidden" name="attr_charactergold_max" value="50000">
	
	<input type="text" id="sheet-adventurerCondition" name="attr_charactercondition" placeholder="None" spellcheck="false">
</div>

<!------------------------------>
<!-- WEAPON & INSTRUMENT NAME -->
<!------------------------------>
<div class="sheet-weapon_instrument-name">
		
	<input type="text" class="sheet-weapon_name-input" name="attr_weaponname" placeholder="Staff" spellcheck="false">
	
	<input type="text" class="sheet-instrument_name-input" name="attr_instrumentname" placeholder="Flute" spellcheck="false">
	
</div>

<!------------------------------------------------->
<!-- WEAPON & INSTRUMENT EXPERIENCE & INITIATIVE -->
<!------------------------------------------------->
<div class="sheet-weapon_instrument-exp-initiative_actions">
	<!--WEAPON-->
	<div class="sheet-weapon_instrument-expbox-group">
			<label class="sheet-weapon_instrument-expbox">
			<input type="checkbox" name="attr_weapontierbox1" value="1">
			<span></span>
		</label>
		<label class="sheet-weapon_instrument-expbox">
			<input type="checkbox" name="attr_weapontierbox2" value="1">
			<span></span>
		</label>
		
		<input type="hidden" name="attr_weapon_tier">
	</div>
	
	<button type="action" class="sheet-initiativeButton" name="act_rollInitiative"></button>
	<button type="action" class="sheet-weaponAttackButton" name="act_rollWeapon"></button>
	
	<!--INSTRUMENT-->
	<div class="sheet-weapon_instrument-expbox-group">
		<label class="sheet-weapon_instrument-expbox">
			<input type="checkbox" name="attr_instrumenttierbox1" value="1">
			<span></span>
		</label>
		<label class="sheet-weapon_instrument-expbox">
			<input type="checkbox" name="attr_instrumenttierbox2" value="1">
			<span></span>
		</label>
		
		<input type="hidden" name="attr_instrument_tier">
	</div>
	<button type="action" class="sheet-instrumentPlayNoteButton" name="act_rollInstrument"></button>
</div>

<!------------>
<!-- SKILLS -->
<!------------>
<div class="sheet-skills-container">
	<!--------------------------->
	<!-- STRENGTH & PERCEPTION -->
	<!--------------------------->
	<div class="sheet-skills-pair-container">
		<!-- STRENGTH -->
		<div class="sheet-skill" id="skill-1"> 
			<div class="sheet-skill-expbox-group-left">
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_strength-expbox1" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_strength-expbox2" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_strength-expbox3" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_strength-expbox4" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_strength-expbox5" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_strength-expbox6" value="1">
					<span></span>
				</label>
				
				<input type="hidden" name="attr_strength">
			</div>
			
			<button type="action" class="sheet-skillActionButton" name="act_rollStrength"></button>
			<button type="action" class="sheet-skillToolButton" name="act_rollStrengthTool"></button>
		</div>
	
		<!-- PERCEPTION -->
		<div class="sheet-skill" id="skill-6"> 
			<div class="sheet-skill-expbox-group-right">
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_perception-expbox1" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_perception-expbox2" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_perception-expbox3" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_perception-expbox4" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_perception-expbox5" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_perception-expbox6" value="1">
					<span></span>
				</label>
				
				<input type="hidden" name="attr_perception">
			</div>
			
			<button type="action" class="sheet-skillActionButton" name="act_rollPerception"></button>
			<button type="action" class="sheet-skillToolButton" name="act_rollPerceptionTool"></button>
		</div>
	</div>
	
	<!----------------------------------->
	<!-- DEXTERITY & MECHANICS (MECH.) -->
	<!----------------------------------->
	<div class="sheet-skills-pair-container">
		<!-- DEXTERITY -->
		<div class="sheet-skill" id="skill-2"> 
			<div class="sheet-skill-expbox-group-left">
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_dexterity-expbox1" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_dexterity-expbox2" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_dexterity-expbox3" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_dexterity-expbox4" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_dexterity-expbox5" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_dexterity-expbox6" value="1">
					<span></span>
				</label>
				
				<input type="hidden" name="attr_dexterity">
			</div>
			
			<button type="action" class="sheet-skillActionButton" name="act_rollDexterity"></button>
			<button type="action" class="sheet-skillToolButton" name="act_rollDexterityTool"></button>
		</div>
	
		<!-- MECHANICS (MECH.) -->
		<div class="sheet-skill" id="skill-7"> 
			<div class="sheet-skill-expbox-group-right">
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_mechanics-expbox1" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_mechanics-expbox2" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_mechanics-expbox3" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_mechanics-expbox4" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_mechanics-expbox5" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_mechanics-expbox6" value="1">
					<span></span>
				</label>
				
				<input type="hidden" name="attr_mechanics">
			</div>
			
			<button type="action" class="sheet-skillActionButton" name="act_rollMechanics"></button>
			<button type="action" class="sheet-skillToolButton" name="act_rollMechanicsTool"></button>
		</div>
	</div>
	
	<!------------------------------------>
	<!-- ACROBATICS (ACROB.) & SURVIVAL -->
	<!------------------------------------>
	<div class="sheet-skills-pair-container">
		<!-- ACROBATICS (ACROB.) -->
		<div class="sheet-skill" id="skill-3"> 
			<div class="sheet-skill-expbox-group-left">
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_acrobatics-expbox1" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_acrobatics-expbox2" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_acrobatics-expbox3" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_acrobatics-expbox4" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_acrobatics-expbox5" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_acrobatics-expbox6" value="1">
					<span></span>
				</label>
				
				<input type="hidden" name="attr_acrobatics">
			</div>
			
			<button type="action" class="sheet-skillActionButton" name="act_rollAcrobatics"></button>
			<button type="action" class="sheet-skillToolButton" name="act_rollAcrobaticsTool"></button>
		</div>
	
		<!-- SURVIVAL -->
		<div class="sheet-skill" id="skill-8"> 
			<div class="sheet-skill-expbox-group-right">
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_survival-expbox1" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_survival-expbox2" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_survival-expbox3" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_survival-expbox4" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_survival-expbox5" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_survival-expbox6" value="1">
					<span></span>
				</label>
				
				<input type="hidden" name="attr_survival">
			</div>
			
			<button type="action" class="sheet-skillActionButton" name="act_rollSurvival"></button>
			<button type="action" class="sheet-skillToolButton" name="act_rollSurvivalTool"></button>
		</div>
	</div>
	
	<!------------------------------------------>
	<!-- REFLEX & ARCANE/ALCHEMY (ARC./ALCH.) -->
	<!------------------------------------------>
	<div class="sheet-skills-pair-container">
		<!-- REFLEX -->
		<div class="sheet-skill" id="skill-4"> 
			<div class="sheet-skill-expbox-group-left">
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_reflex-expbox1" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_reflex-expbox2" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_reflex-expbox3" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_reflex-expbox4" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_reflex-expbox5" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_reflex-expbox6" value="1">
					<span></span>
				</label>
				
				<input type="hidden" name="attr_reflex">
			</div>
			
			<button type="action" class="sheet-skillActionButton" name="act_rollReflex"></button>
			<button type="action" class="sheet-skillToolButton" name="act_rollReflexTool"></button>
		</div>
	
		<!-- ARCANE/ALCHEMY (ARC./ALCH.) -->
		<div class="sheet-skill" id="skill-9"> 
			<div class="sheet-skill-expbox-group-right">
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_arcane/alchemy-expbox1" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_arcane/alchemy-expbox2" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_arcane/alchemy-expbox3" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_arcane/alchemy-expbox4" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_arcane/alchemy-expbox5" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_arcane/alchemy-expbox6" value="1">
					<span></span>
				</label>
				
				<input type="hidden" name="attr_arcane/alchemy">
			</div>
			
			<button type="action" class="sheet-skillActionButton" name="act_rollArcane/Alchemy"></button>
			<button type="action" class="sheet-skillToolButton" name="act_rollArcane/AlchemyTool"></button>
		</div>
	</div>
	
	<!--------------------->
	<!-- DEFENSE & MUSIC -->
	<!--------------------->
	<div class="sheet-skills-pair-container">
		<!-- DEFENSE -->
		<div class="sheet-skill" id="skill-5"> 
			<div class="sheet-skill-expbox-group-left">
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_defense-expbox1" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_defense-expbox2" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_defense-expbox3" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_defense-expbox4" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_defense-expbox5" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_defense-expbox6" value="1">
					<span></span>
				</label>
				
				<input type="hidden" name="attr_defense">
			</div>
			
			<button type="action" class="sheet-skillActionButton" name="act_rollDefense"></button>
			<button type="action" class="sheet-skillToolButton" name="act_rollDefenseTool"></button>
		</div>
	
		<!-- MUSIC -->
		<div class="sheet-skill" id="skill-10"> 
			<div class="sheet-skill-expbox-group-right">
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_music-expbox1" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_music-expbox2" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_music-expbox3" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_music-expbox4" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_music-expbox5" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_music-expbox6" value="1">
					<span></span>
				</label>
				
				<input type="hidden" name="attr_music">
			</div>
			
			<button type="action" class="sheet-skillActionButton" name="act_rollMusic"></button>
			<button type="action" class="sheet-skillToolButton" name="act_rollMusicTool"></button>
		</div>
	</div>
</div>

<!------------------------->
<!--EXPERIENCE & REROLLD6-->
<!------------------------->
<div class="sheet-experience-rerolld6">
	<div class="sheet-experiencebox-group">
		<label class="sheet-experiencebox">
			<input type="checkbox" name="attr_experiencebox1" value="1">
			<span></span>
		</label>
		<label class="sheet-experiencebox">
			<input type="checkbox" name="attr_experiencebox2" value="1">
			<span></span>
		</label>
		
		<label class="sheet-experiencebox">
			<input type="checkbox" name="attr_experiencebox3" value="1">
			<span></span>
		</label>
		<label class="sheet-experiencebox">
			<input type="checkbox" name="attr_experiencebox4" value="1">
			<span></span>
		</label>
		
		<label class="sheet-experiencebox">
			<input type="checkbox" name="attr_experiencebox5" value="1">
			<span></span>
		</label>
		<label class="sheet-experiencebox">
			<input type="checkbox" name="attr_experiencebox6" value="1">
			<span></span>
		</label>
		<label class="sheet-experiencebox">
			<input type="checkbox" name="attr_experiencebox7" value="1">
			<span></span>
		</label>
		<label class="sheet-experiencebox">
			<input type="checkbox" name="attr_experiencebox8" value="1">
			<span></span>
		</label>
		<label class="sheet-experiencebox">
			<input type="checkbox" name="attr_experiencebox9" value="1">
			<span></span>
		</label>
		<label class="sheet-experiencebox">
			<input type="checkbox" name="attr_experiencebox10" value="1">
			<span></span>
		</label>
		
		<input type="hidden" name="attr_experience">
		<input type="hidden" name="attr_experience_max" value="10">
	</div>
	
	<button type="action" class="sheet-rerolld6Button" name="act_reroll1D6"></button>
</div>

<!--------->
<!--ITEMS-->
<!--------->
<div class="sheet-items-container">
	<!--ITEM 1 & ITEM 2-->
	<div class="sheet-items-pair-container">
		<div class="sheet-item">
			<input type="text" class="sheet-itemname-input" name="attr_item1name" placeholder="Item" spellcheck="false">
		</div>
		
		<div class="sheet-item">
			<input type="text" class="sheet-itemname-input" name="attr_item2name" placeholder="Item" spellcheck="false">
		</div>
	</div>
	
	<!--ITEM 3 & ITEM 4-->
	<div class="sheet-items-pair-container">
		<div class="sheet-item">
			<input type="text" class="sheet-itemname-input" name="attr_item3name" placeholder="Item" spellcheck="false">
		</div>
		
		<div class="sheet-item">
			<input type="text" class="sheet-itemname-input" name="attr_item4name" placeholder="Item" spellcheck="false">
		</div>
	</div>
	
	<!--ITEM 5 & ITEM 6-->
	<div class="sheet-items-pair-container">
		<div class="sheet-item">
			<input type="text" class="sheet-itemname-input" name="attr_item5name" placeholder="Item" spellcheck="false">
		</div>
		
		<div class="sheet-item">
			<input type="text" class="sheet-itemname-input" name="attr_item6name" placeholder="Item" spellcheck="false">
		</div>
	</div>
	
	<!--ITEM 7 & ITEM 8-->
	<div class="sheet-items-pair-container">
		<div class="sheet-item">
			<input type="text" class="sheet-itemname-input" name="attr_item7name" placeholder="Item" spellcheck="false">
		</div>
		
		<div class="sheet-item">
			<input type="text" class="sheet-itemname-input" name="attr_item8name" placeholder="Item" spellcheck="false">
		</div>
	</div>
</div>

<!--------->
<!--NOTES-->
<!--------->
<div class="sheet-notes-container">
    <textarea class="sheet-notes-textarea" name="attr_characternotes" maxlength="320" placeholder="Enter your notes here..." spellcheck="false"></textarea>
</div>

<!-------------------------------->
<!-- ROLLTEMPLATE: HIDDEN ROLLS -->
<!-------------------------------->
<rolltemplate class="sheet-rolltemplate-hidden-singleroll">
	{{#roll1}}
	<div style="display: none;">
		{{roll1}}
	</div>
	{{/roll1}}
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-hidden-doubleroll">
	{{#roll1}}
	<div style="display: none;">
		{{roll1}}
	</div>
	{{/roll1}}
	
	{{#roll2}}
	<div style="display: none;">
		{{roll2}}
	</div>
	{{/roll2}}
</rolltemplate>

<!------------------------------>
<!-- ROLLTEMPLATE: INITIATIVE -->
<!------------------------------>
<rolltemplate class="sheet-rolltemplate-initiativeroll">
    <div class="sheet-initiativeroll-title" style="background-color:{{titleColor}};">
		<div class="sheet-initiativeroll-title-text">
			{{title}}
		</div>
    </div>
	
	<div class="sheet-initiativeroll-container">
		<div class="sheet-initiativeroll-body">
			<!--Initiative Roll 1-->
			{{#initiativeRoll0}}
				<div class="sheet-initiativeroll-dicebox" style="background-color: {{initiativeRollColor0}}">
					{{initiativeRoll0}}
				</div>
			{{/initiativeRoll0}}
			
			<!--Initiative Roll 2-->
			{{#initiativeRoll1}}
				<div class="sheet-initiativeroll-plus">+</div>
				<div class="sheet-initiativeroll-dicebox" style="background-color: {{initiativeRollColor1}}">
					{{initiativeRoll1}}
				</div>
			{{/initiativeRoll1}}
			
			<!--Initiative Roll 3-->
			{{#initiativeRoll2}}
				<div class="sheet-initiativeroll-plus">+</div>
				<div class="sheet-initiativeroll-dicebox" style="background-color: {{initiativeRollColor2}}">
					{{initiativeRoll2}}
				</div>
			{{/initiativeRoll2}}
			
			<!--Initiative Roll 4-->
			{{#initiativeRoll3}}
				<div class="sheet-initiativeroll-plus">+</div>
				<div class="sheet-initiativeroll-dicebox" style="background-color: {{initiativeRollColor3}}">
					{{initiativeRoll3}}
				</div>
			{{/initiativeRoll3}}
			
			<!--Initiative Roll 5-->
			{{#initiativeRoll4}}
				<div class="sheet-initiativeroll-plus">+</div>
				<div class="sheet-initiativeroll-dicebox" style="background-color: {{initiativeRollColor4}}">
					{{initiativeRoll4}}
				</div>
			{{/initiativeRoll4}}
			
			<!--Initiative Roll 6-->
			{{#initiativeRoll5}}
				<div class="sheet-initiativeroll-plus">+</div>
				<div class="sheet-initiativeroll-dicebox" style="background-color: {{initiativeRollColor5}}">
					{{initiativeRoll5}}
				</div>
			{{/initiativeRoll5}}
			
			<!--Initiative Roll 7-->
			{{#initiativeRoll6}}
				<div class="sheet-initiativeroll-plus">+</div>
				<div class="sheet-initiativeroll-dicebox" style="background-color: {{initiativeRollColor6}}">
					{{initiativeRoll6}}
				</div>
			{{/initiativeRoll6}}
			
			<!--Initiative Roll 8-->
			{{#initiativeRoll7}}
				<div class="sheet-initiativeroll-plus">+</div>
				<div class="sheet-initiativeroll-dicebox" style="background-color: {{initiativeRollColor7}}">
					{{initiativeRoll7}}
				</div>
			{{/initiativeRoll7}}
			
			<!--Initiative Roll 9-->
			{{#initiativeRoll8}}
				<div class="sheet-initiativeroll-plus">+</div>
				<div class="sheet-initiativeroll-dicebox" style="background-color: {{initiativeRollColor8}}">
					{{initiativeRoll8}}
				</div>
			{{/initiativeRoll8}}
			
			<!--Initiative Roll 10-->
			{{#initiativeRoll9}}
				<div class="sheet-initiativeroll-plus">+</div>
				<div class="sheet-initiativeroll-dicebox" style="background-color: {{initiativeRollColor9}}">
					{{initiativeRoll9}}
				</div>
			{{/initiativeRoll9}}
		</div>
    </div>
	
	<div class="sheet-initiativeroll-total" style="background-color:{{initiativeTotalResultColor}};">
		<div class="sheet-initiativeroll-total-title">
			Total
		</div>
		<div class="sheet-initiativeroll-total-result">
			{{initiativetotalResult}}
		</div>
    </div>
</rolltemplate>

<!-------------------------->
<!-- ROLLTEMPLATE: WEAPON -->
<!-------------------------->
<rolltemplate class="sheet-rolltemplate-weaponroll">
    <div class="sheet-weaponroll-title" style="background-color:{{titleColor}};">
		<div class="sheet-weaponroll-title-text">
			{{title}}
		</div>
    </div>
	
	<div class="sheet-weaponroll-container">
		<div class="sheet-weaponroll-body">
			<!--Attack Roll 1-->
			{{#attackRoll0}}
				<div class="sheet-weaponroll-dicebox" style="background-color: {{attackRollColor0}}">
					{{attackRoll0}}
				</div>
			{{/attackRoll0}}
			
			<!--Attack Roll 2-->
			{{#attackRoll1}}
				<div class="sheet-weaponroll-plus">+</div>
				<div class="sheet-weaponroll-dicebox" style="background-color: {{attackRollColor1}}">
					{{attackRoll1}}
				</div>
			{{/attackRoll1}}
			
			<!--Attack Roll 3-->
			{{#attackRoll2}}
				<div class="sheet-weaponroll-plus">+</div>
				<div class="sheet-weaponroll-dicebox" style="background-color: {{attackRollColor2}}">
					{{attackRoll2}}
				</div>
			{{/attackRoll2}}
			
			<!--Attack Roll 4-->
			{{#attackRoll3}}
				<div class="sheet-weaponroll-plus">+</div>
				<div class="sheet-weaponroll-dicebox" style="background-color: {{attackRollColor3}}">
					{{attackRoll3}}
				</div>
			{{/attackRoll3}}
			
			<!--Attack Roll 5-->
			{{#attackRoll4}}
				<div class="sheet-weaponroll-plus">+</div>
				<div class="sheet-weaponroll-dicebox" style="background-color: {{attackRollColor4}}">
					{{attackRoll4}}
				</div>
			{{/attackRoll4}}
			
			<!--Attack Roll 6-->
			{{#attackRoll5}}
				<div class="sheet-weaponroll-plus">+</div>
				<div class="sheet-weaponroll-dicebox" style="background-color: {{attackRollColor5}}">
					{{attackRoll5}}
				</div>
			{{/attackRoll5}}
			
			<!--Attack Roll 7-->
			{{#attackRoll6}}
				<div class="sheet-weaponroll-plus">+</div>
				<div class="sheet-weaponroll-dicebox" style="background-color: {{attackRollColor6}}">
					{{attackRoll6}}
				</div>
			{{/attackRoll6}}
			
			<!--Attack Roll 8-->
			{{#attackRoll7}}
				<div class="sheet-weaponroll-plus">+</div>
				<div class="sheet-weaponroll-dicebox" style="background-color: {{attackRollColor7}}">
					{{attackRoll7}}
				</div>
			{{/attackRoll7}}
			
			<!--Attack Roll 9-->
			{{#attackRoll8}}
				<div class="sheet-weaponroll-plus">+</div>
				<div class="sheet-weaponroll-dicebox" style="background-color: {{attackRollColor8}}">
					{{attackRoll8}}
				</div>
			{{/attackRoll8}}
			
			<!--Attack Roll 10-->
			{{#attackRoll9}}
				<div class="sheet-weaponroll-plus">+</div>
				<div class="sheet-weaponroll-dicebox" style="background-color: {{attackRollColor9}}">
					{{attackRoll9}}
				</div>
			{{/attackRoll9}}
		</div>
    </div>
	
	<div class="sheet-weaponroll-description" style="background-color:{{attackDescriptionColor}};">
		<div class="sheet-weaponroll-description-text">
			{{attackDescriptionText}}
		</div>
    </div>
	
	<div class="sheet-weaponroll-container">
		<div class="sheet-weaponroll-body">
			<!--Damage Roll 1-->
			{{#damageRoll0}}
				<div class="sheet-weaponroll-dicebox" style="background-color: {{damageRollColor0}}">
					{{damageRoll0}}
				</div>
			{{/damageRoll0}}
			
			<!--Damage Roll 2-->
			{{#damageRoll1}}
				<div class="sheet-weaponroll-plus">+</div>
				<div class="sheet-weaponroll-dicebox" style="background-color: {{damageRollColor1}}">
					{{damageRoll1}}
				</div>
			{{/damageRoll1}}
			
			<!--Damage Roll 3-->
			{{#damageRoll2}}
				<div class="sheet-weaponroll-plus">+</div>
				<div class="sheet-weaponroll-dicebox" style="background-color: {{damageRollColor2}}">
					{{damageRoll2}}
				</div>
			{{/damageRoll2}}
			
			<!--Damage Roll 4-->
			{{#damageRoll3}}
				<div class="sheet-weaponroll-plus">+</div>
				<div class="sheet-weaponroll-dicebox" style="background-color: {{damageRollColor3}}">
					{{damageRoll3}}
				</div>
			{{/damageRoll3}}
			
			<!--Damage Roll 5-->
			{{#damageRoll4}}
				<div class="sheet-weaponroll-plus">+</div>
				<div class="sheet-weaponroll-dicebox" style="background-color: {{damageRollColor4}}">
					{{damageRoll4}}
				</div>
			{{/damageRoll4}}
			
			<!--Damage Roll 6-->
			{{#damageRoll5}}
				<div class="sheet-weaponroll-plus">+</div>
				<div class="sheet-weaponroll-dicebox" style="background-color: {{damageRollColor5}}">
					{{damageRoll5}}
				</div>
			{{/damageRoll5}}
			
			<!--Damage Roll 7-->
			{{#damageRoll6}}
				<div class="sheet-weaponroll-plus">+</div>
				<div class="sheet-weaponroll-dicebox" style="background-color: {{damageRollColor6}}">
					{{damageRoll6}}
				</div>
			{{/damageRoll6}}
			
			<!--Damage Roll 8-->
			{{#damageRoll7}}
				<div class="sheet-weaponroll-plus">+</div>
				<div class="sheet-weaponroll-dicebox" style="background-color: {{damageRollColor7}}">
					{{damageRoll7}}
				</div>
			{{/damageRoll7}}
			
			<!--Damage Roll 9-->
			{{#damageRoll8}}
				<div class="sheet-weaponroll-plus">+</div>
				<div class="sheet-weaponroll-dicebox" style="background-color: {{damageRollColor8}}">
					{{damageRoll8}}
				</div>
			{{/damageRoll8}}
			
			<!--Damage Roll 10-->
			{{#damageRoll9}}
				<div class="sheet-weaponroll-plus">+</div>
				<div class="sheet-weaponroll-dicebox" style="background-color: {{damageRollColor9}}">
					{{damageRoll9}}
				</div>
			{{/damageRoll9}}
		</div>
    </div>
	
	<div class="sheet-weaponroll-description" style="background-color:{{attackDescriptionColor}};">
		<div class="sheet-weaponroll-description-text">
			{{damageDescriptionText}}
		</div>
    </div>
</rolltemplate>

<!------------------------------>
<!-- ROLLTEMPLATE: INSTRUMENT -->
<!------------------------------>
<rolltemplate class="sheet-rolltemplate-instrumentroll">
    <div class="sheet-instrumentroll-title" style="background-color:{{titleColor}};">
		<div class="sheet-instrumentroll-title-text">
			{{title}}
		</div>
    </div>
	
	<div class="sheet-instrumentroll-container">
		<div class="sheet-instrumentroll-body">
			<!--Instrument Roll 1-->
			{{#instrumentRoll0}}
				<div class="sheet-instrumentroll-dicebox" style="background-color: {{instrumentRollColor0}}">
					{{instrumentRoll0}}
				</div>
			{{/instrumentRoll0}}
			
			<!--Instrument Roll 2-->
			{{#instrumentRoll1}}
				<div class="sheet-instrumentroll-plus">+</div>
				<div class="sheet-instrumentroll-dicebox" style="background-color: {{instrumentRollColor1}}">
					{{instrumentRoll1}}
				</div>
			{{/instrumentRoll1}}
			
			<!--Instrument Roll 3-->
			{{#instrumentRoll2}}
				<div class="sheet-instrumentroll-plus">+</div>
				<div class="sheet-instrumentroll-dicebox" style="background-color: {{instrumentRollColor2}}">
					{{instrumentRoll2}}
				</div>
			{{/instrumentRoll2}}
			
			<!--Instrument Roll 4-->
			{{#instrumentRoll3}}
				<div class="sheet-instrumentroll-plus">+</div>
				<div class="sheet-instrumentroll-dicebox" style="background-color: {{instrumentRollColor3}}">
					{{instrumentRoll3}}
				</div>
			{{/instrumentRoll3}}
			
			<!--Instrument Roll 5-->
			{{#instrumentRoll4}}
				<div class="sheet-instrumentroll-plus">+</div>
				<div class="sheet-instrumentroll-dicebox" style="background-color: {{instrumentRollColor4}}">
					{{instrumentRoll4}}
				</div>
			{{/instrumentRoll4}}
			
			<!--Instrument Roll 6-->
			{{#instrumentRoll5}}
				<div class="sheet-instrumentroll-plus">+</div>
				<div class="sheet-instrumentroll-dicebox" style="background-color: {{instrumentRollColor5}}">
					{{instrumentRoll5}}
				</div>
			{{/instrumentRoll5}}
			
			<!--Instrument Roll 7-->
			{{#instrumentRoll6}}
				<div class="sheet-instrumentroll-plus">+</div>
				<div class="sheet-instrumentroll-dicebox" style="background-color: {{instrumentRollColor6}}">
					{{instrumentRoll6}}
				</div>
			{{/instrumentRoll6}}
			
			<!--Instrument Roll 8-->
			{{#instrumentRoll7}}
				<div class="sheet-instrumentroll-plus">+</div>
				<div class="sheet-instrumentroll-dicebox" style="background-color: {{instrumentRollColor7}}">
					{{instrumentRoll7}}
				</div>
			{{/instrumentRoll7}}
			
			<!--Instrument Roll 9-->
			{{#instrumentRoll8}}
				<div class="sheet-instrumentroll-plus">+</div>
				<div class="sheet-instrumentroll-dicebox" style="background-color: {{instrumentRollColor8}}">
					{{instrumentRoll8}}
				</div>
			{{/instrumentRoll8}}
			
			<!--Instrument Roll 10-->
			{{#instrumentRoll9}}
				<div class="sheet-instrumentroll-plus">+</div>
				<div class="sheet-instrumentroll-dicebox" style="background-color: {{instrumentRollColor9}}">
					{{instrumentRoll9}}
				</div>
			{{/instrumentRoll9}}
		</div>
		
		<div class="sheet-instrumentroll-text">
			{{instrumentDescription}}
		</div>
    </div>
</rolltemplate>

<!------------------------->
<!-- ROLLTEMPLATE: SKILL -->
<!------------------------->
<rolltemplate class="sheet-rolltemplate-skillroll">
    <div class="sheet-skillroll-title" style="background-color:{{titleColor}};">
		<div class="sheet-skillroll-title-text">
			{{title}}
		</div>
    </div>
	
	<div class="sheet-skillroll-container">
		<div class="sheet-skillroll-body">
			<!--Skill Roll 1-->
			{{#skillRoll0}}
				<div class="sheet-skillroll-dicebox" style="background-color: {{skillRollColor0}}">
					{{skillRoll0}}
				</div>
			{{/skillRoll0}}
			
			<!--Skill Roll 2-->
			{{#skillRoll1}}
				<div class="sheet-skillroll-plus">+</div>
				<div class="sheet-skillroll-dicebox" style="background-color: {{skillRollColor1}}">
					{{skillRoll1}}
				</div>
			{{/skillRoll1}}
			
			<!--Skill Roll 3-->
			{{#skillRoll2}}
				<div class="sheet-skillroll-plus">+</div>
				<div class="sheet-skillroll-dicebox" style="background-color: {{skillRollColor2}}">
					{{skillRoll2}}
				</div>
			{{/skillRoll2}}
			
			<!--Skill Roll 4-->
			{{#skillRoll3}}
				<div class="sheet-skillroll-plus">+</div>
				<div class="sheet-skillroll-dicebox" style="background-color: {{skillRollColor3}}">
					{{skillRoll3}}
				</div>
			{{/skillRoll3}}
			
			<!--Skill Roll 5-->
			{{#skillRoll4}}
				<div class="sheet-skillroll-plus">+</div>
				<div class="sheet-skillroll-dicebox" style="background-color: {{skillRollColor4}}">
					{{skillRoll4}}
				</div>
			{{/skillRoll4}}
			
			<!--Skill Roll 6-->
			{{#skillRoll5}}
				<div class="sheet-skillroll-plus">+</div>
				<div class="sheet-skillroll-dicebox" style="background-color: {{skillRollColor5}}">
					{{skillRoll5}}
				</div>
			{{/skillRoll5}}
			
			<!--Skill Roll 7-->
			{{#skillRoll6}}
				<div class="sheet-skillroll-plus">+</div>
				<div class="sheet-skillroll-dicebox" style="background-color: {{skillRollColor6}}">
					{{skillRoll6}}
				</div>
			{{/skillRoll6}}
			
			<!--Skill Roll 8-->
			{{#skillRoll7}}
				<div class="sheet-skillroll-plus">+</div>
				<div class="sheet-skillroll-dicebox" style="background-color: {{skillRollColor7}}">
					{{skillRoll7}}
				</div>
			{{/skillRoll7}}
			
			<!--Skill Roll 9-->
			{{#skillRoll8}}
				<div class="sheet-skillroll-plus">+</div>
				<div class="sheet-skillroll-dicebox" style="background-color: {{skillRollColor8}}">
					{{skillRoll8}}
				</div>
			{{/skillRoll8}}
			
			<!--Skill Roll 10-->
			{{#skillRoll9}}
				<div class="sheet-skillroll-plus">+</div>
				<div class="sheet-skillroll-dicebox" style="background-color: {{skillRollColor9}}">
					{{skillRoll9}}
				</div>
			{{/skillRoll9}}
		</div>
    </div>
	
	<div class="sheet-skillroll-description" style="background-color:{{skillDescriptionColor}};">
		<div class="sheet-skillroll-description-text">
			{{skillDescriptionText}}
		</div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-rerolld6">
	<div class="sheet-rerolld6-title" style="background-color:{{titleColor}};">
		<div class="sheet-rerolld6-title-text">
			{{title}}
		</div>
    </div>
	
	<div class="sheet-rerolld6-container">
		<div class="sheet-rerolld6-body">
			<div class="sheet-rerolld6-dicebox" style="background-color: {{resultColor}}">
				{{rerollResult}}
			</div>
		</div>
    </div>
</rolltemplate>

<script type="text/worker">
/****************************/
/*** SHEET INITIALIZATION ***/
/****************************/
on("sheet:opened", function() {
    // Check if the 'firstInitialization' attribute exists and is false
    getAttrs(["firstInitialization"], function(values) {
        if (!values.firstInitialization || values.firstInitialization === "false") {
			// Ensure attribute is put at the top of the attribute list
			setAttrs({ "firstInitialization": "false" });
			
			// Call the function to initialize some string attributes to ensure they are on top in the "Attribute & Abilities" tab
			initializeStringAttributes();
			
            // Call the function to initialize the checkboxes
            initializeCheckboxFields();

            // After initializing, set 'firstInitialization' to true
            setAttrs({ "firstInitialization": "true" });
        }
    });
});

function initializeStringAttributes() {
	const attributesToInitialize = [
    "hp", "hp_max", "charactername", "characterage", "characteroccupation", "charactergold", "charactercondition",
    "weaponname", "instrumentname", "weapon_tier", "instrument_tier", "strength", "perception", "dexterity",
    "mechanics", "acrobatics", "survival", "reflex", "arcane/alchemy", "defense", "music", "experience", "experience_max",
    "item1Name", "item2Name", "item3Name", "item4Name", "item5Name", "item6Name", "item7Name", "item8Name",
    "characterNotes"
	];

    let initializeAttrs = {};
    attributesToInitialize.forEach(attr => {
		if ([attr] == "hp_max" || [attr] == "experience_max") {
			initializeAttrs[attr] = "10";
		} else {
			initializeAttrs[attr] = "";
		}
    });
    setAttrs(initializeAttrs);
}

// Function to initialize checkboxes (skills and hearts)
function initializeCheckboxFields() {
    const skills = [
        "strength", "perception", "dexterity", "mechanics",
        "acrobatics", "survival", "reflex", "arcane/alchemy",
        "defense", "music"
    ];

    let attributesToCheck = [];
    skills.forEach(skill => {
        for (let i = 1; i <= 6; i++) {
            attributesToCheck.push(`${skill}-expbox${i}`);
        }
    });

    // Heart checkboxes (1-10)
    for (let i = 1; i <= 10; i++) {
        attributesToCheck.push(`heartbox${i}`);
    }
	
	// Weapon tier checkboxes (1-2)
    for (let i = 1; i <= 2; i++) {
        attributesToCheck.push(`weapontierbox${i}`);
    }
	
	// Instrument tier checkboxes (1-2)
    for (let i = 1; i <= 2; i++) {
        attributesToCheck.push(`instrumenttierbox${i}`);
    }
	
	// experience checkboxes (1-10)
    for (let i = 1; i <= 10; i++) {
        attributesToCheck.push(`experiencebox${i}`);
    }
	

    // Get all necessary values at once
    getAttrs(attributesToCheck, function(values) {
        let updates = {};

        // Initialize the first three skill checkboxes to "1" and the last three to "0"
        skills.forEach(skill => {
            for (let i = 1; i <= 6; i++) {
                let attrName = `${skill}-expbox${i}`;
                let currentValue = values[attrName];
				
				if (i <= 3) {
					// Set to "1" if the checkbox is still at its initial state (i.e., "0")
					if (currentValue === "0") {
						updates[attrName] = "1";
					}
				} else {
					updates[attrName] = "0";
				}
                
            }
        });

        // Update heart checkboxes only if they are set to "0"
        for (let i = 1; i <= 10; i++) {
            let heartBox = `heartbox${i}`;
            let currentValue = values[heartBox];

            // Set to "1" if the heart checkbox is still at its initial state (i.e., "0")
            if (currentValue === "0") {
                updates[heartBox] = "1";
            }
        }
		
		// Initialize weapon tier checkboxes as zero
        for (let i = 1; i <= 2; i++) {
            let weapontierbox = `weapontierbox${i}`;
			updates[weapontierbox] = "0";
        }
		
		// Initialize instrument tier checkboxes as zero
        for (let i = 1; i <= 2; i++) {
            let instrumenttierbox = `instrumenttierbox${i}`;
			updates[instrumenttierbox] = "0";
        }
		
        // Initialize general experience checkboxes as zero
        for (let i = 1; i <= 10; i++) {
            let experiencebox = `experiencebox${i}`;
			updates[experiencebox] = "0";
        }

        // Apply the changes if necessary
        if (Object.keys(updates).length > 0) {
            setAttrs(updates);
        }
    });
}

/********************************/
/***GENERIC FUNCTIONS & TABLES***/
/********************************/
function getSuccessfulRolls(rolls) {
    // Filter the array to include only rolls 4, 5, and 6
    return rolls.filter(roll => roll >= 4);
}

function getFailedRolls(rolls) {
    // Filter the array to include only rolls 1, 2, and 3
    return rolls.filter(roll => roll <= 3);
}

function determineRollOutcome(successfulRolls) {
    return successfulRolls.length > 0 ? "SUCCESS" : "FAILURE";
}

function formatRollsWithPlus(rolls) {
    // Use the join method to combine array elements with " + "
    return rolls.join(" + ");
}

// Function to generate RollTemplate part string
function buildRollTemplatePart(diceArray, action) {
    let strRollTemplatePart = ""; // Initialize the result string

    // Iterate over the dice array
    for (let i = 0; i < diceArray.length; i++) {
        const diceVal = diceArray[i]; // Current dice value
        const diceColor = diceColorTable[diceVal.toString()]; // Look up color

        // Generate the strings for this dice roll
        let strRoll = `{{${action}Roll${i}=${diceVal}}}`;
        let strColor = `{{${action}RollColor${i}=${diceColor}}}`;

        // Append to the main string with a space in between
        strRollTemplatePart += `${strRoll} ${strColor} `;
    }

    // Return the final constructed string
    return strRollTemplatePart.trim(); // Trim to remove any trailing spaces
}

// Function to generate RollTemplate part string for specific rolls where the dice result bg should be black
function buildBlackRollTemplatePart(diceArray, action) {
    let strRollTemplatePart = ""; // Initialize the result string

    // Iterate over the dice array
    for (let i = 0; i < diceArray.length; i++) {
        const diceVal = diceArray[i]; // Current dice value
        const diceColor = resultColorTable["N/A"]; // Look up color

        // Generate the strings for this dice roll
        let strRoll = `{{${action}Roll${i}=${diceVal}}}`;
        let strColor = `{{${action}RollColor${i}=${diceColor}}}`;

        // Append to the main string with a space in between
        strRollTemplatePart += `${strRoll} ${strColor} `;
    }

    // Return the final constructed string
    return strRollTemplatePart.trim(); // Trim to remove any trailing spaces
}

const resultColorTable = {
    "SUCCESS": 	"#4BA22E",
    "FAILURE":	"#A5A29E",
	"N/A":		"#1D1B1A",
};

const diceColorTable = {
    "6": 	"#4BA22E",
    "5":	"#4BA22E",
	"4": 	"#4BA22E",
	"3":	"#A5A29E",	
	"2":	"#A5A29E",
	"1":	"#A5A29E"
};

/*******************/
/*** HEART BOXES ***/
/*******************/
// Listener for heart checkboxes (1-10)
on("change:heartbox1 change:heartbox2 change:heartbox3 change:heartbox4 change:heartbox5 change:heartbox6 change:heartbox7 change:heartbox8 change:heartbox9 change:heartbox10", function(event) {
    // List of heart checkboxes (heartbox1 to heartbox10)
    const heartboxes = [];
    for (let i = 1; i <= 10; i++) {
        heartboxes.push(`heartbox${i}`);
    }

    // Retrieve the current values of all heart checkboxes
    getAttrs(heartboxes, function(values) {
        let updatedAttrs = {};
        let heartSum = 0;

        // Convert checkbox values to integers (default to 0 if unchecked)
        let checkboxValues = heartboxes.map((checkbox, index) => {
            return { checkbox, value: parseInt(values[checkbox]) || 0, index: index + 1 };
        });

        // Sum the checked boxes (value = 1 means checked)
        checkboxValues.forEach(item => {
            if (item.value === 1) {
                heartSum++;
            }
        });

        // Auto-uncheck later checkboxes if one in the middle is unchecked
        checkboxValues.forEach(item => {
            let isChecked = parseInt(event.newValue) === 1;
            let source = event.sourceAttribute;
            let checkboxNum = item.index;

            // If a checkbox is unchecked, clear later checkboxes
            if (!isChecked) {
                if (source === `heartbox${checkboxNum}`) {
                    for (let i = checkboxNum + 1; i <= 10; i++) {
                        updatedAttrs[`heartbox${i}`] = 0;
                    }
                }
            }

            // Auto-check earlier checkboxes if a later one is checked
            if (isChecked) {
                if (source === `heartbox${checkboxNum}`) {
                    for (let i = checkboxNum - 1; i >= 1; i--) {
                        if (parseInt(values[`heartbox${i}`]) !== 1) {
                            updatedAttrs[`heartbox${i}`] = 1;
                        }
                    }
                }
            }
        });

        // Update the HP attribute with the calculated sum
        updatedAttrs["hp"] = heartSum;

        // Apply the changes if necessary
        if (Object.keys(updatedAttrs).length > 0) {
            setAttrs(updatedAttrs);
        }
    });
});

/***********************************/
/*** CHARACTER STRING ATTRIBUTES ***/
/*** NAME, OCCUPATION, WEAPON ******/
/*** INSTRUMENT, ITEMS AND NOTES ***/
/***********************************/
const charNameXPAttr = ['charactername', 'characteroccupation', 'charactercondition', 'weaponname', 'instrumentname', 'item1name', 'item2name', 'item3name', 'item4name', 'item5name', 'item6name', 'item7name', 'item8name','characternotes'];
charNameXPAttr.forEach(attr => {
    on(`change:${attr}`, () => {	
        getAttrs([attr], values => {			
            let attrNew = values[attr];

            setAttrs({
                [`${attr}`]: attrNew 
            });
        });
    });
});

/**********************************/
/*** CHARACTER DIGIT ATTRIBUTES ***/
/*** AGE & GOLD *******************/
/**********************************/
const charAgeGoldAttr = ['characterAge', 'characterGold'];
charAgeGoldAttr.forEach(attr => {
    on(`change:${attr}`, () => {
		// Determine the corresponding max attribute name
		const maxAttr = `${attr}_max`;
		
        getAttrs([attr, maxAttr], values => {			
            let attrNew = values[attr];
			const attrMax = values[maxAttr];
			
			// Remove any non-numeric characters
			attrNew = attrNew.replace(/\D/g, '');

			// Remove leading zeroes, allowing only a single leading zero
			attrNew = attrNew.replace(/^0+(?=\d)/, '');
			
			// Convert the attribute and max value to integers for comparison
            const currentValue = parseInt(attrNew, 10) || 0;
            const maxValue = parseInt(attrMax, 10) || 0;

            // Validate that the current value doesn't exceed the max value
            if (currentValue > maxValue) {
                attrNew = maxValue.toString();
            }

            setAttrs({
                [`${attr}`]: attrNew 
            });
        });
    });
});

/*************************************/
/*** WEAPON & INSTRUMENT EXPERIENCE***/
/*************************************/
// Listens for changes to the checkboxes of the weapon and instrument experience (tierbox1 to tierbox2)
const weaponinstrumentTypes = ["weapon", "instrument"];

weaponinstrumentTypes.forEach(type => {
    on(`change:${type}tierbox1 change:${type}tierbox2`, function(event) {
        let checkboxes = [];
        for (let i = 1; i <= 2; i++) {
            checkboxes.push(`${type}tierbox${i}`);
        }

        getAttrs(checkboxes, function(values) {
            let updatedAttrs = {};
            let sum = 0;

            let checkboxValues = checkboxes.map((checkbox, index) => {
                return { checkbox, value: parseInt(values[checkbox]) || 0, index: index + 1 };
            });

            checkboxValues.forEach(item => {
                if (item.value === 1) {
                    sum++;
                }
            });

            checkboxValues.forEach(item => {
                let isChecked = parseInt(event.newValue) === 1;
                let source = event.sourceAttribute;
                let checkboxNum = item.index;

                if (!isChecked) {
                    if (source === `${type}tierbox${checkboxNum}`) {
                        for (let i = checkboxNum + 1; i <= 2; i++) {
                            updatedAttrs[`${type}tierbox${i}`] = 0;
                        }
                    }
                }

                if (isChecked) {
                    if (source === `${type}tierbox${checkboxNum}`) {
                        for (let i = checkboxNum - 1; i >= 1; i--) {
                            let earlierBox = `${type}tierbox${i}`;
                            let earlierValue = parseInt(values[earlierBox]) || 0;
                            if (earlierValue !== 1) {
                                updatedAttrs[earlierBox] = 1;
                            }
                        }
                    }
                }
            });

            updatedAttrs[`${type}_tier`] = sum;

            if (Object.keys(updatedAttrs).length > 0) {
                setAttrs(updatedAttrs);
            }
        });
    });
});



/******************/
/*** INITIATIVE ***/
/******************/
on('clicked:rollInitiative', (info) => {
	getAttrs(["reflex"], function (values) {
		let reflexXP = values.reflex;
		
		let initiativeDiceRoll = `&{template:hidden-singleroll} {{InitiativeRoll=[[${reflexXP}d6 &{tracker}]]}}`;
        
		startRoll(initiativeDiceRoll, (results) => {
		
			// TITLE HANDLING
			let TitleColor = "#1D1B1A";
			let InitiativeTitle = "Initiative";
			
			// INITIATIVE HANDLING
			let InitiativeRollTemplate = buildBlackRollTemplatePart(results.results.InitiativeRoll.dice, "initiative");
			
			let TotalResultColor = resultColorTable["SUCCESS"];
			let InitiativeTotalResult = results.results.InitiativeRoll.result;
			
			InitiativeRollTemplate += `{{initiativeTotalResultColor=${TotalResultColor}}} {{initiativetotalResult=${InitiativeTotalResult}}}`;

			let rollSummary = `&{template:initiativeroll} {{titleColor=${TitleColor}}} {{title=${InitiativeTitle}}} ${InitiativeRollTemplate}`;
			startRoll(rollSummary, (summaryResults) => {
				finishRoll(summaryResults.rollId, {});
			});

			finishRoll(results.rollId, {});
		});
	});
});

/***********************/
/*** WEAPON - ATTACK ***/
/***********************/
on('clicked:rollWeapon', (info) => {
    getAttrs(["weaponname", "weapon_tier", "strength", "dexterity"], function (values) {
		let weaponName = values.weaponName;
		let weaponTier = values.weapon_tier;
        let strengthXP = values.strength;
		let dexterityXP = values.dexterity;
        
        let diceRoll = `&{template:hidden-doubleroll} {{AttackRoll=[[${weaponTier}d6 + ${dexterityXP}d6]]}} {{DamageRoll=[[${weaponTier}d6 + ${strengthXP}d6]]}}`;
        
        startRoll(diceRoll, (results) => {
		
			// TITLE HANDLING
			let TitleColor = "#1D1B1A";
			let AttackTitle = (weaponName !== "") ? "Attack, " + weaponName :"Attack, Unarmed";
			
			
			// ATTACKROLL HANDLING
			let AttackRollTemplate = buildRollTemplatePart(results.results.AttackRoll.dice, "attack");
			
			let AttackRollSuccesses = getSuccessfulRolls(results.results.AttackRoll.dice);
			
			let attackDescriptionColor = resultColorTable[determineRollOutcome(AttackRollSuccesses)];
			let attackDescriptionText = AttackRollSuccesses.length + " successes";
			
			AttackRollTemplate += `{{attackDescriptionColor=${attackDescriptionColor}}} {{attackDescriptionText=${attackDescriptionText}}}`;
			
			// DAMAGEROLL HANDLING
			let DamageRollTemplate = buildRollTemplatePart(results.results.DamageRoll.dice, "damage");
			
			let DamageRollSuccesses = getSuccessfulRolls(results.results.DamageRoll.dice);
			let damageDescriptionColor = diceColorTable[determineRollOutcome(DamageRollSuccesses)];
			let damageDescriptionText = DamageRollSuccesses.length + " damage";
			
			DamageRollTemplate += `{{damageDescriptionColor=${damageDescriptionColor}}} {{damageDescriptionText=${damageDescriptionText}}}`;
		
			let rollSummary = `&{template:weaponroll} {{titleColor=${TitleColor}}} {{title=${AttackTitle}}} ${AttackRollTemplate} ${DamageRollTemplate}`;
			startRoll(rollSummary, (summaryResults) => {
				finishRoll(summaryResults.rollId, {});
			});

			finishRoll(results.rollId, {});
        });
    });
});

/********************************/
/*** INSTRUMENT - Play Melody ***/
/********************************/
on('clicked:rollInstrument', (info) => {
    getAttrs(["instrumentname", "instrument_tier", "music"], function (values) {
		let instrumentName = values.instrumentName;
		let instrumentTier = values.instrument_tier;
		let musicXP = values.music;
        
		let instrumentDiceRoll = `&{template:hidden-singleroll} {{InstrumentRoll=[[${instrumentTier}d6 + ${musicXP}d6]]}}`;
        
        startRoll(instrumentDiceRoll, (results) => {
		
			// TITLE HANDLING
			let TitleColor = "#1D1B1A";
			let InstrumentTitle = (instrumentName !== "") ? "Play music, " + instrumentName: "Play music, Whistling";
			
			// INSTRUMENTROLL HANDLING
			let InstrumentRollTemplate = buildBlackRollTemplatePart(results.results.InstrumentRoll.dice, "instrument");
			let InstrumentRollSuccesses = getSuccessfulRolls(results.results.InstrumentRoll.dice);
			
			//let instrumentDescription = "Re-roll twice (any amount of dice).";
			
			//InstrumentRollTemplate += `{{instrumentDescription=${instrumentDescription}}}`;
		
			let rollSummary = `&{template:instrumentroll} {{titleColor=${TitleColor}}} {{title=${InstrumentTitle}}} ${InstrumentRollTemplate}`;
            startRoll(rollSummary, (summaryResults) => {
                finishRoll(summaryResults.rollId, {});
            });
			
			finishRoll(results.rollId, {});
        });
    });    
});

/**************/
/*** SKILLS ***/
/**************/
// Listens for changes to the checkboxes of the skills (expbox1 to expbox6 for each skill) with the following skills to monitor
const skills = [
	"strength", "perception", "dexterity", "mechanics",
	"acrobatics", "survival", "reflex", "arcane/alchemy",
	"defense", "music"
];

// Create a listener for each skill to update the corresponding exp attribute
skills.forEach(skill => {
    on(`change:${skill}-expbox1 change:${skill}-expbox2 change:${skill}-expbox3 change:${skill}-expbox4 change:${skill}-expbox5 change:${skill}-expbox6`, function(event) {
        // Get the checkboxes for the current skill (expbox1 to expbox6)
        let checkboxes = [];
        for (let i = 1; i <= 6; i++) {
            checkboxes.push(`${skill}-expbox${i}`);
        }

        // Retrieve the current values of all checkboxes
        getAttrs(checkboxes, function(values) {
            let updatedAttrs = {};
            let sum = 0;

            // Convert checkbox values to integers (default to 0 if unchecked)
            let checkboxValues = checkboxes.map((checkbox, index) => {
                return { checkbox, value: parseInt(values[checkbox]) || 0, index: index + 1 };
            });

            // Sum the checked boxes (value = 1 means checked)
            checkboxValues.forEach(item => {
                if (item.value === 1) {
                    sum++;
                }
            });

            // Auto-uncheck later checkboxes if one in the middle is unchecked
            checkboxValues.forEach(item => {
                let isChecked = parseInt(event.newValue) === 1;
                let source = event.sourceAttribute;
                let checkboxNum = item.index;

                // If a checkbox is unchecked, clear later checkboxes
                if (!isChecked) {
                    if (source === `${skill}-expbox${checkboxNum}`) {
                        for (let i = checkboxNum + 1; i <= 6; i++) {
                            updatedAttrs[`${skill}-expbox${i}`] = 0;
                        }
                    }
                }

                // Auto-check earlier checkboxes if a later one is checked
                if (isChecked) {
                    if (source === `${skill}-expbox${checkboxNum}`) {
                        for (let i = checkboxNum - 1; i >= 1; i--) {
                            if (parseInt(values[`${skill}-expbox${i}`]) !== 1) {
                                updatedAttrs[`${skill}-expbox${i}`] = 1;
                            }
                        }
                    }
                }
            });

            // Update the corresponding <skill>_exp attribute with the sum of checked boxes
            updatedAttrs[`${skill}`] = sum;

            // Apply the changes if necessary
            if (Object.keys(updatedAttrs).length > 0) {
                setAttrs(updatedAttrs);
            }
        });
    });
	
	// Generic function to handle both button variants
    const handleSkillRoll = (skillType) => {
        getAttrs([skill], values => {
            let skillpoints = parseInt(values[skill]);
			
			if (skillType === "Tool") {
				skillpoints += 1;
			}
            
            let diceRoll = `&{template:hidden-singleroll} {{SkillRoll=[[${skillpoints}d6 + 3d6]]}}`;
            startRoll(diceRoll, (results) => {
                
                // TITLE HANDLING
                let TitleColor = "#1D1B1A";
                let SkillTitle = skillTranslationTable[skill] + (skillType === "Tool" ? " with tool" : ""); // Add "(Tool)" to title for tool rolls
                
                // SKILLROLL HANDLING
                let SkillRollTemplate = buildRollTemplatePart(results.results.SkillRoll.dice, "skill");
                
                let SkillRollSuccesses = getSuccessfulRolls(results.results.SkillRoll.dice);
                
                let skillDescriptionColor = resultColorTable[determineRollOutcome(SkillRollSuccesses)];
                let skillDescriptionText = SkillRollSuccesses.length + " successes";
                
                SkillRollTemplate += `{{skillDescriptionColor=${skillDescriptionColor}}} {{skillDescriptionText=${skillDescriptionText}}}`;
                
                let rollSummary = `&{template:skillroll} {{titleColor=${TitleColor}}} {{title=${SkillTitle}}} ${SkillRollTemplate}`;
                startRoll(rollSummary, (summaryResults) => {
                    finishRoll(summaryResults.rollId, {});
                });

                finishRoll(results.rollId, {});
            });
        });    
    };

    // Attach event handlers for both skill and skill tool rolls
    on(`clicked:roll${skill}`, () => handleSkillRoll(""));
    on(`clicked:roll${skill}Tool`, () => handleSkillRoll("Tool"));
});

const skillTranslationTable = {
    "strength": 		"Strength",
    "perception":		"Perception",
	"dexterity": 		"Dexterity",
	"mechanics":		"Mechanics",
	"acrobatics":		"Acrobatics",
	"survival":			"Survival",
	"reflex":			"Reflex",
	"arcane/alchemy":	"Arcane/Alchemy",
	"defense":			"Defense",
	"music":			"Music",
};


/*****************************/
/*** EXPERIENCE & REROLLD6 ***/
/*****************************/
// Listener for experience checkboxes (1-10) experiencebox
on("change:experiencebox1 change:experiencebox2 change:experiencebox3 change:experiencebox4 change:experiencebox5 change:experiencebox6 change:experiencebox7 change:experiencebox8 change:experiencebox9 change:experiencebox10", function(event) {
    const experienceboxes = [];
    for (let i = 1; i <= 10; i++) {
        experienceboxes.push(`experiencebox${i}`);
    }

    // Retrieve the current values of all experience checkboxes
    getAttrs(experienceboxes, function(values) {
        let updatedAttrs = {};
        let expSum = 0;

        // Convert checkbox values to integers (default to 0 if unchecked)
        let checkboxValues = experienceboxes.map((checkbox, index) => {
            return { checkbox, value: parseInt(values[checkbox]) || 0, index: index + 1 };
        });

        // Sum the checked boxes (value = 1 means checked)
        checkboxValues.forEach(item => {
            if (item.value === 1) {
                expSum++;
            }
        });

        // Auto-uncheck later checkboxes if one in the middle is unchecked
        checkboxValues.forEach(item => {
            let isChecked = parseInt(event.newValue) === 1;
            let source = event.sourceAttribute;
            let checkboxNum = item.index;

            // If a checkbox is unchecked, clear later checkboxes
            if (!isChecked) {
                if (source === `experiencebox${checkboxNum}`) {
                    for (let i = checkboxNum + 1; i <= 10; i++) {
                        updatedAttrs[`experiencebox${i}`] = 0;
                    }
                }
            }

            // Auto-check earlier checkboxes if a later one is checked
            if (isChecked) {
                if (source === `experiencebox${checkboxNum}`) {
                    for (let i = checkboxNum - 1; i >= 1; i--) {
                        if (parseInt(values[`experiencebox${i}`]) !== 1) {
                            updatedAttrs[`experiencebox${i}`] = 1;
                        }
                    }
                }
            }
        });

        // Update the experience attribute with the calculated sum
        updatedAttrs["experience"] = expSum;

        // Apply the changes if necessary
        if (Object.keys(updatedAttrs).length > 0) {
            setAttrs(updatedAttrs);
        }
    });
});

on('clicked:reroll1D6', (info) => {
	let diceRoll = `&{template:hidden-singleroll} {{Reroll=[[1d6]]}}`;
	startRoll(diceRoll, (results) => {
	
		// TITLE HANDLING
		let TitleColor = "#1D1B1A";
		let RerollTitle = "Re-roll Dice";
		let ResultColor = "#1D1B1A";

		let rollSummary = `&{template:rerolld6} {{titleColor=${TitleColor}}} {{title=${RerollTitle}}} {{rerollResult=${results.results.Reroll.dice[0]}}} {{resultColor=${ResultColor}}}`;
		startRoll(rollSummary, (summaryResults) => {
			finishRoll(summaryResults.rollId, {});
		});

		finishRoll(results.rollId, {});
	});
});
</script>